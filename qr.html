<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0, user-scalable=yes">
<title>QR Code Generator | Mobile-Friendly</title>
<script src="https://cdn.jsdelivr.net/npm/qr-code-styling@1.6.0/lib/qr-code-styling.js"></script>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
<link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap">
<style>
/* CSS Reset & Base Styles */
:root {
  --primary: #4361ee;
  --primary-dark: #3a56d4;
  --secondary: #7209b7;
  --accent: #f72585;
  --success: #4cc9f0;
  --warning: #ff9e00;
  --danger: #f94144;
  --light: #f8f9fa;
  --dark: #212529;
  --gray-100: #f8f9fa;
  --gray-200: #e9ecef;
  --gray-300: #dee2e6;
  --gray-400: #ced4da;
  --gray-500: #adb5bd;
  --gray-600: #6c757d;
  --gray-700: #495057;
  --gray-800: #343a40;
  --gray-900: #212529;
  
  --border-radius-sm: 8px;
  --border-radius-md: 12px;
  --border-radius-lg: 16px;
  --border-radius-xl: 24px;
  
  --shadow-sm: 0 2px 8px rgba(0, 0, 0, 0.08);
  --shadow-md: 0 4px 16px rgba(0, 0, 0, 0.1);
  --shadow-lg: 0 8px 32px rgba(0, 0, 0, 0.12);
  --shadow-inset: inset 0 2px 4px rgba(0, 0, 0, 0.05);
  
  --font-heading: 'Poppins', -apple-system, BlinkMacSystemFont, sans-serif;
  --font-body: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
  
  --transition-fast: 150ms ease;
  --transition-base: 250ms ease;
  --transition-slow: 350ms ease;
  
  --safe-area-top: env(safe-area-inset-top);
  --safe-area-bottom: env(safe-area-inset-bottom);
  --safe-area-left: env(safe-area-inset-left);
  --safe-area-right: env(safe-area-inset-right);
}

* {
  box-sizing: border-box;
  margin: 0;
  padding: 0;
  -webkit-tap-highlight-color: transparent;
}

html {
  font-size: 16px;
  scroll-behavior: smooth;
}

body {
  font-family: var(--font-body);
  font-size: 1rem;
  line-height: 1.5;
  color: var(--gray-800);
  background: linear-gradient(135deg, #f5f7fa 0%, #e4edf5 100%);
  min-height: 100vh;
  min-height: -webkit-fill-available;
  padding: 0;
  overflow-x: hidden;
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
}

/* Typography */
h1, h2, h3, h4, h5, h6 {
  font-family: var(--font-heading);
  font-weight: 600;
  line-height: 1.2;
  margin-bottom: 0.75rem;
}

h1 {
  font-size: 1.75rem;
  font-weight: 700;
}

h2 {
  font-size: 1.5rem;
}

h3 {
  font-size: 1.25rem;
}

p {
  margin-bottom: 1rem;
}

a {
  color: var(--primary);
  text-decoration: none;
}

/* Layout */
.app-container {
  max-width: 100%;
  width: 100%;
  min-height: 100vh;
  display: flex;
  flex-direction: column;
  padding-top: var(--safe-area-top);
  padding-bottom: var(--safe-area-bottom);
}

/* Header */
.app-header {
  background: white;
  padding: 1rem 1.25rem;
  box-shadow: var(--shadow-sm);
  position: sticky;
  top: 0;
  z-index: 100;
  border-bottom: 1px solid var(--gray-200);
}

.header-content {
  display: flex;
  justify-content: space-between;
  align-items: center;
}

.header-title {
  display: flex;
  flex-direction: column;
  gap: 0.25rem;
}

.header-title h1 {
  margin: 0;
  color: var(--dark);
  font-size: 1.5rem;
}

.header-subtitle {
  font-size: 0.85rem;
  color: var(--gray-600);
}

.mobile-menu-btn {
  display: flex;
  align-items: center;
  justify-content: center;
  width: 44px;
  height: 44px;
  background: var(--primary);
  color: white;
  border: none;
  border-radius: var(--border-radius-md);
  cursor: pointer;
  font-size: 1.25rem;
  transition: all var(--transition-base);
}

.mobile-menu-btn:hover, .mobile-menu-btn:active {
  background: var(--primary-dark);
}

/* Main Content */
.main-content {
  flex: 1;
  padding: 1.25rem;
  display: flex;
  flex-direction: column;
  gap: 1.5rem;
}

/* Tab Navigation */
.tab-navigation {
  display: flex;
  background: white;
  border-radius: var(--border-radius-lg);
  box-shadow: var(--shadow-sm);
  overflow: hidden;
  margin-bottom: 0.5rem;
}

.tab-btn {
  flex: 1;
  padding: 1rem;
  background: none;
  border: none;
  font-family: var(--font-heading);
  font-weight: 500;
  font-size: 1rem;
  color: var(--gray-600);
  cursor: pointer;
  transition: all var(--transition-fast);
  display: flex;
  align-items: center;
  justify-content: center;
  gap: 0.5rem;
}

.tab-btn i {
  font-size: 1.1rem;
}

.tab-btn.active {
  color: var(--primary);
  background: rgba(67, 97, 238, 0.05);
  border-bottom: 3px solid var(--primary);
}

.tab-btn:active {
  background: rgba(67, 97, 238, 0.1);
}

/* Tab Content */
.tab-content {
  display: none;
  animation: fadeIn 0.3s ease;
}

@keyframes fadeIn {
  from { opacity: 0; transform: translateY(5px); }
  to { opacity: 1; transform: translateY(0); }
}

.tab-content.active {
  display: block;
}

/* Cards */
.card {
  background: white;
  border-radius: var(--border-radius-lg);
  box-shadow: var(--shadow-md);
  padding: 1.5rem;
  margin-bottom: 1.25rem;
}

.card-header {
  display: flex;
  align-items: center;
  justify-content: space-between;
  margin-bottom: 1.25rem;
}

.card-title {
  display: flex;
  align-items: center;
  gap: 0.75rem;
  font-size: 1.1rem;
  font-weight: 600;
  color: var(--dark);
}

.card-title i {
  color: var(--primary);
  width: 24px;
  text-align: center;
}

/* Form Elements */
.form-group {
  margin-bottom: 1.5rem;
}

.form-label {
  display: block;
  font-weight: 500;
  margin-bottom: 0.5rem;
  color: var(--gray-800);
  font-size: 0.95rem;
}

.form-hint {
  display: block;
  font-size: 0.85rem;
  color: var(--gray-600);
  margin-bottom: 0.75rem;
  line-height: 1.4;
}

.input-wrapper {
  position: relative;
}

.input-wrapper i {
  position: absolute;
  left: 1rem;
  top: 50%;
  transform: translateY(-50%);
  color: var(--gray-500);
  z-index: 1;
}

.input-wrapper input, 
.input-wrapper select, 
.input-wrapper textarea {
  width: 100%;
  padding: 0.875rem 1rem 0.875rem 3rem;
  font-size: 1rem;
  font-family: var(--font-body);
  border: 2px solid var(--gray-300);
  border-radius: var(--border-radius-md);
  background: white;
  color: var(--gray-800);
  transition: all var(--transition-fast);
  -webkit-appearance: none;
  appearance: none;
}

.input-wrapper textarea {
  min-height: 100px;
  resize: vertical;
  padding-left: 1rem;
}

.input-wrapper input:focus, 
.input-wrapper select:focus, 
.input-wrapper textarea:focus {
  outline: none;
  border-color: var(--primary);
  box-shadow: 0 0 0 3px rgba(67, 97, 238, 0.15);
}

.input-wrapper select {
  background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='16' height='16' viewBox='0 0 24 24' fill='none' stroke='%236c757d' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3E%3Cpolyline points='6 9 12 15 18 9'%3E%3C/polyline%3E%3C/svg%3E");
  background-repeat: no-repeat;
  background-position: right 1rem center;
  background-size: 16px;
  padding-right: 3rem;
}

/* Logo Grid */
.logo-grid {
  display: grid;
  grid-template-columns: repeat(4, 1fr);
  gap: 0.75rem;
  margin-top: 0.5rem;
}

.logo-option {
  width: 100%;
  aspect-ratio: 1;
  border-radius: var(--border-radius-md);
  border: 2px solid var(--gray-300);
  background: white;
  cursor: pointer;
  object-fit: contain;
  padding: 0.75rem;
  transition: all var(--transition-fast);
  display: flex;
  align-items: center;
  justify-content: center;
}

.logo-option img {
  max-width: 100%;
  max-height: 100%;
}

.logo-option.active {
  border-color: var(--primary);
  background: rgba(67, 97, 238, 0.05);
  transform: scale(1.05);
  box-shadow: 0 4px 12px rgba(67, 97, 238, 0.15);
}

/* Color Picker */
.color-picker {
  display: grid;
  grid-template-columns: repeat(2, 1fr);
  gap: 1rem;
  margin-top: 1rem;
}

.color-input label {
  display: flex;
  align-items: center;
  gap: 0.75rem;
  margin-bottom: 0.5rem;
  font-weight: 500;
}

.color-input i {
  font-size: 1.25rem;
}

.color-input input {
  width: 100%;
  height: 48px;
  border: 2px solid var(--gray-300);
  border-radius: var(--border-radius-md);
  padding: 0.25rem;
  cursor: pointer;
  background: white;
  transition: border-color var(--transition-fast);
}

.color-input input:focus {
  border-color: var(--primary);
  outline: none;
}

/* Sliders */
.slider-container {
  margin-top: 1rem;
}

.slider-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-bottom: 0.5rem;
}

.slider-value {
  font-weight: 600;
  color: var(--primary);
  font-size: 0.95rem;
}

input[type="range"] {
  width: 100%;
  height: 8px;
  -webkit-appearance: none;
  background: linear-gradient(to right, var(--primary) 0%, var(--primary) 50%, var(--gray-300) 50%, var(--gray-300) 100%);
  border-radius: 4px;
  outline: none;
}

input[type="range"]::-webkit-slider-thumb {
  -webkit-appearance: none;
  width: 24px;
  height: 24px;
  border-radius: 50%;
  background: white;
  border: 3px solid var(--primary);
  cursor: pointer;
  box-shadow: var(--shadow-md);
  transition: all var(--transition-fast);
}

input[type="range"]::-webkit-slider-thumb:hover {
  transform: scale(1.1);
}

/* Advanced Options */
.advanced-toggle {
  display: flex;
  justify-content: space-between;
  align-items: center;
  width: 100%;
  padding: 1rem;
  background: rgba(67, 97, 238, 0.05);
  border: none;
  border-radius: var(--border-radius-md);
  font-family: var(--font-heading);
  font-weight: 600;
  font-size: 1rem;
  color: var(--primary);
  cursor: pointer;
  margin-bottom: 1rem;
  transition: all var(--transition-fast);
}

.advanced-toggle:active {
  background: rgba(67, 97, 238, 0.1);
}

.advanced-content {
  max-height: 0;
  overflow: hidden;
  transition: max-height var(--transition-slow) ease-out;
}

.advanced-content.expanded {
  max-height: 1000px;
}

/* Buttons */
.btn {
  display: inline-flex;
  align-items: center;
  justify-content: center;
  gap: 0.75rem;
  padding: 1rem 1.5rem;
  font-family: var(--font-heading);
  font-weight: 600;
  font-size: 1rem;
  border: none;
  border-radius: var(--border-radius-md);
  cursor: pointer;
  transition: all var(--transition-base);
  text-align: center;
  width: 100%;
  margin-bottom: 0.75rem;
}

.btn i {
  font-size: 1.1rem;
}

.btn-primary {
  background: var(--primary);
  color: white;
  box-shadow: 0 4px 12px rgba(67, 97, 238, 0.25);
}

.btn-primary:hover, .btn-primary:active {
  background: var(--primary-dark);
  transform: translateY(-2px);
  box-shadow: 0 6px 16px rgba(67, 97, 238, 0.3);
}

.btn-secondary {
  background: white;
  color: var(--primary);
  border: 2px solid var(--primary);
}

.btn-secondary:hover, .btn-secondary:active {
  background: rgba(67, 97, 238, 0.05);
}

.btn-success {
  background: var(--success);
  color: white;
}

.btn-danger {
  background: var(--danger);
  color: white;
}

.btn-group {
  display: flex;
  flex-direction: column;
  gap: 0.75rem;
  margin-top: 1.5rem;
}

/* QR Preview */
.qr-preview-container {
  background: white;
  border-radius: var(--border-radius-lg);
  box-shadow: var(--shadow-lg);
  padding: 2rem 1.5rem;
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  text-align: center;
  margin-bottom: 1.5rem;
  min-height: 320px;
  border: 2px dashed var(--gray-300);
  transition: all var(--transition-base);
}

.qr-preview-container.has-qr {
  border-color: transparent;
}

#qr {
  width: 100%;
  display: flex;
  justify-content: center;
  align-items: center;
  min-height: 250px;
}

.qr-placeholder {
  display: flex;
  flex-direction: column;
  align-items: center;
  gap: 1rem;
  color: var(--gray-600);
}

.qr-placeholder i {
  font-size: 4rem;
  color: var(--gray-400);
  opacity: 0.7;
}

.qr-info {
  background: rgba(67, 97, 238, 0.05);
  border-radius: var(--border-radius-md);
  padding: 1.25rem;
  margin-top: 1.5rem;
  display: none;
}

.qr-info.show {
  display: block;
  animation: slideUp 0.3s ease;
}

@keyframes slideUp {
  from { opacity: 0; transform: translateY(10px); }
  to { opacity: 1; transform: translateY(0); }
}

.info-row {
  display: flex;
  justify-content: space-between;
  padding: 0.5rem 0;
  border-bottom: 1px solid rgba(0, 0, 0, 0.05);
}

.info-row:last-child {
  border-bottom: none;
}

.info-label {
  font-weight: 500;
  color: var(--gray-700);
}

.info-value {
  font-weight: 600;
  color: var(--primary);
}

/* Messages */
.message {
  padding: 1rem;
  border-radius: var(--border-radius-md);
  margin-top: 1rem;
  display: none;
  align-items: center;
  gap: 0.75rem;
  animation: fadeIn 0.3s ease;
}

.message.show {
  display: flex;
}

.message i {
  font-size: 1.25rem;
}

.message-error {
  background: rgba(249, 65, 68, 0.1);
  color: var(--danger);
  border-left: 4px solid var(--danger);
}

.message-success {
  background: rgba(76, 201, 240, 0.1);
  color: var(--success);
  border-left: 4px solid var(--success);
}

.message-warning {
  background: rgba(255, 158, 0, 0.1);
  color: var(--warning);
  border-left: 4px solid var(--warning);
}

/* Loading State */
.loading {
  position: absolute;
  top: 0;
  left: 0;
  right: 0;
  bottom: 0;
  background: rgba(255, 255, 255, 0.9);
  border-radius: var(--border-radius-lg);
  display: none;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  gap: 1rem;
  z-index: 10;
}

.loading.show {
  display: flex;
}

.spinner {
  width: 48px;
  height: 48px;
  border: 4px solid var(--gray-300);
  border-top: 4px solid var(--primary);
  border-radius: 50%;
  animation: spin 1s linear infinite;
}

@keyframes spin {
  0% { transform: rotate(0deg); }
  100% { transform: rotate(360deg); }
}

/* Footer */
.app-footer {
  background: var(--gray-900);
  color: white;
  padding: 1.5rem 1.25rem;
  text-align: center;
  margin-top: auto;
}

.footer-content {
  display: flex;
  flex-direction: column;
  align-items: center;
  gap: 1rem;
}

.footer-links {
  display: flex;
  gap: 1.5rem;
}

.footer-links a {
  color: var(--gray-400);
  transition: color var(--transition-fast);
}

.footer-links a:hover {
  color: white;
}

.copyright {
  font-size: 0.875rem;
  color: var(--gray-500);
}

/* Responsive Design */
@media (min-width: 576px) {
  html {
    font-size: 17px;
  }
  
  .main-content {
    padding: 1.5rem;
  }
  
  .logo-grid {
    grid-template-columns: repeat(6, 1fr);
  }
  
  .btn-group {
    flex-direction: row;
    flex-wrap: wrap;
  }
  
  .btn {
    flex: 1;
    min-width: 150px;
  }
}

@media (min-width: 768px) {
  html {
    font-size: 18px;
  }
  
  .app-header {
    padding: 1.25rem 2rem;
  }
  
  .main-content {
    padding: 2rem;
  }
  
  .mobile-menu-btn {
    display: none;
  }
  
  .logo-grid {
    grid-template-columns: repeat(8, 1fr);
  }
  
  .color-picker {
    grid-template-columns: repeat(4, 1fr);
  }
  
  .btn-group {
    flex-direction: row;
  }
  
  .btn {
    margin-bottom: 0;
  }
}

@media (min-width: 992px) {
  .app-container {
    flex-direction: row;
  }
  
  .app-header {
    width: 300px;
    height: 100vh;
    position: fixed;
    top: 0;
    left: 0;
    border-right: 1px solid var(--gray-200);
    border-bottom: none;
    padding: 2rem;
    display: flex;
    flex-direction: column;
  }
  
  .header-content {
    flex-direction: column;
    align-items: flex-start;
    gap: 2rem;
  }
  
  .main-content {
    margin-left: 300px;
    width: calc(100% - 300px);
    padding: 2.5rem;
  }
  
  .tab-navigation {
    flex-direction: column;
    width: 100%;
  }
  
  .tab-btn {
    justify-content: flex-start;
    padding: 1.25rem 1.5rem;
    border-bottom: 1px solid var(--gray-200);
    border-right: none;
  }
  
  .tab-btn.active {
    border-bottom: 1px solid var(--gray-200);
    border-right: 3px solid var(--primary);
  }
  
  .content-grid {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 2rem;
  }
  
  .settings-column {
    grid-column: 1;
  }
  
  .preview-column {
    grid-column: 2;
    position: sticky;
    top: 2.5rem;
    height: fit-content;
  }
  
  .logo-grid {
    grid-template-columns: repeat(6, 1fr);
  }
}

@media (min-width: 1200px) {
  .app-header {
    width: 350px;
  }
  
  .main-content {
    margin-left: 350px;
    width: calc(100% - 350px);
  }
  
  .content-grid {
    grid-template-columns: 1.2fr 0.8fr;
    gap: 2.5rem;
  }
}

/* Mobile Optimizations */
@media (max-width: 575px) {
  h1 {
    font-size: 1.5rem;
  }
  
  h2 {
    font-size: 1.3rem;
  }
  
  .card {
    padding: 1.25rem;
  }
  
  .logo-grid {
    grid-template-columns: repeat(4, 1fr);
    gap: 0.5rem;
  }
  
  .logo-option {
    padding: 0.5rem;
  }
}

/* Touch Device Optimizations */
@media (hover: none) and (pointer: coarse) {
  .btn, .tab-btn, .logo-option, .advanced-toggle {
    min-height: 48px;
  }
  
  input, select, textarea {
    font-size: 16px; /* Prevents iOS zoom on focus */
  }
  
  .btn:hover, .tab-btn:hover {
    transform: none;
  }
  
  .btn:active, .tab-btn:active {
    transform: scale(0.98);
  }
}

/* Dark Mode Support */
@media (prefers-color-scheme: dark) {
  :root {
    --light: #121212;
    --dark: #f8f9fa;
    --gray-100: #1e1e1e;
    --gray-200: #2d2d2d;
    --gray-300: #3d3d3d;
    --gray-400: #5a5a5a;
    --gray-500: #7a7a7a;
    --gray-600: #9a9a9a;
    --gray-700: #bababa;
    --gray-800: #dadada;
    --gray-900: #f0f0f0;
  }
  
  body {
    background: linear-gradient(135deg, #0a0a0a 0%, #1a1a1a 100%);
  }
  
  .app-header, .card, .qr-preview-container, .tab-navigation {
    background: var(--gray-100);
    border-color: var(--gray-300);
  }
  
  .input-wrapper input, 
  .input-wrapper select, 
  .input-wrapper textarea {
    background: var(--gray-200);
    border-color: var(--gray-400);
    color: var(--gray-800);
  }
  
  .logo-option {
    background: var(--gray-200);
  }
  
  .app-footer {
    background: #0a0a0a;
  }
}

/* Print Styles */
@media print {
  .app-header, .tab-navigation, .btn-group, .app-footer {
    display: none;
  }
  
  .main-content {
    padding: 0;
    margin: 0;
  }
  
  .qr-preview-container {
    box-shadow: none;
    border: 1px solid #ccc;
  }
}
</style>
</head>

<body>
<div class="app-container">
  <!-- Header -->
  <header class="app-header">
    <div class="header-content">
      <div class="header-title">
        <h1><i class="fas fa-qrcode"></i> QR Generator</h1>
        <p class="header-subtitle">Create beautiful QR codes</p>
      </div>
      <button class="mobile-menu-btn" id="menuToggle">
        <i class="fas fa-bars"></i>
      </button>
    </div>
    
    <!-- Desktop Navigation -->
    <nav class="tab-navigation" id="desktopTabs">
      <button class="tab-btn active" data-tab="content">
        <i class="fas fa-edit"></i> <span class="tab-label">Content</span>
      </button>
      <button class="tab-btn" data-tab="design">
        <i class="fas fa-palette"></i> <span class="tab-label">Design</span>
      </button>
      <button class="tab-btn" data-tab="preview">
        <i class="fas fa-eye"></i> <span class="tab-label">Preview</span>
      </button>
    </nav>
  </header>
  
  <!-- Main Content -->
  <main class="main-content">
    <!-- Mobile Tab Navigation -->
    <nav class="tab-navigation" id="mobileTabs">
      <button class="tab-btn active" data-tab="content">
        <i class="fas fa-edit"></i>
      </button>
      <button class="tab-btn" data-tab="design">
        <i class="fas fa-palette"></i>
      </button>
      <button class="tab-btn" data-tab="preview">
        <i class="fas fa-eye"></i>
      </button>
    </nav>
    
    <div class="content-grid">
      <!-- Settings Column -->
      <div class="settings-column">
        <!-- Content Tab -->
        <div class="tab-content active" id="content-tab">
          <div class="card">
            <div class="card-header">
              <h3 class="card-title">
                <i class="fas fa-qrcode"></i> Content Type
              </h3>
            </div>
            
            <div class="form-group">
              <label for="qrType" class="form-label">What type of QR code?</label>
              <p class="form-hint">Select the type of content you want to encode</p>
              <div class="input-wrapper">
                <i class="fas fa-bolt"></i>
                <select id="qrType" onchange="onTypeChange()">
                  <option value="text">Text / URL</option>
                  <option value="wifi">Wi-Fi Network</option>
                  <option value="email">Email Message</option>
                  <option value="phone">Phone Call</option>
                  <option value="sms">SMS Message</option>
                  <option value="whatsapp">WhatsApp</option>
                  <option value="vcard">Contact (vCard)</option>
                  <option value="location">Location</option>
                  <option value="event">Calendar Event</option>
                </select>
              </div>
            </div>
            
            <div id="dynamicFields">
              <!-- Dynamic fields will be inserted here -->
              <div class="form-group">
                <label for="mainInput" class="form-label">Content</label>
                <p class="form-hint" id="mainHint">Enter text, URL, or any content</p>
                <div class="input-wrapper">
                  <i class="fas fa-link"></i>
                  <input type="text" id="mainInput" placeholder="https://example.com or any text" oninput="validateInput()">
                </div>
              </div>
            </div>
            
            <div class="message message-error" id="errorMessage">
              <i class="fas fa-exclamation-circle"></i>
              <span id="errorText"></span>
            </div>
            
            <div class="message message-success" id="successMessage">
              <i class="fas fa-check-circle"></i>
              <span id="successText"></span>
            </div>
            
            <div class="btn-group">
              <button class="btn btn-primary" onclick="generateQR()" id="generateBtn">
                <i class="fas fa-bolt"></i> Generate QR Code
              </button>
              <button class="btn btn-secondary" onclick="resetSettings()">
                <i class="fas fa-redo"></i> Reset
              </button>
            </div>
          </div>
        </div>
        
        <!-- Design Tab -->
        <div class="tab-content" id="design-tab">
          <div class="card">
            <div class="card-header">
              <h3 class="card-title">
                <i class="fas fa-palette"></i> Logo & Style
              </h3>
            </div>
            
            <div class="form-group">
              <label class="form-label">Logo</label>
              <p class="form-hint">Choose a logo or upload your own</p>
              <div class="logo-grid" id="logoGrid">
                <!-- Logos will be populated by JavaScript -->
              </div>
            </div>
            
            <div class="form-group">
              <label for="customLogo" class="form-label">Upload Custom Logo</label>
              <p class="form-hint">PNG, JPG, SVG (Max 2MB)</p>
              <div class="input-wrapper">
                <i class="fas fa-upload"></i>
                <input type="file" id="customLogo" accept="image/*" onchange="handleCustomLogo()">
              </div>
            </div>
            
            <div class="form-group">
              <label for="logoSize" class="form-label">Logo Size</label>
              <div class="slider-container">
                <div class="slider-header">
                  <span>Size</span>
                  <span class="slider-value" id="logoSizeValue">22%</span>
                </div>
                <input type="range" id="logoSize" min="0.1" max="0.4" step="0.05" value="0.22" oninput="updateLogoSize()">
              </div>
            </div>
            
            <div class="form-group">
              <label for="margin" class="form-label">Margin</label>
              <div class="slider-container">
                <div class="slider-header">
                  <span>Spacing</span>
                  <span class="slider-value" id="marginValue">10px</span>
                </div>
                <input type="range" id="margin" min="0" max="30" step="1" value="10" oninput="updateMargin()">
              </div>
            </div>
            
            <div class="form-group">
              <label class="form-label">Colors</label>
              <p class="form-hint">Customize QR code colors</p>
              <div class="color-picker">
                <div class="color-input">
                  <label for="foregroundColor">
                    <i class="fas fa-square" style="color: #4361ee;"></i> Foreground
                  </label>
                  <input type="color" id="foregroundColor" value="#4361ee" onchange="updateColors()">
                </div>
                <div class="color-input">
                  <label for="backgroundColor">
                    <i class="fas fa-square" style="color: #ffffff;"></i> Background
                  </label>
                  <input type="color" id="backgroundColor" value="#ffffff" onchange="updateColors()">
                </div>
              </div>
            </div>
            
            <button class="advanced-toggle" onclick="toggleAdvanced()">
              <span><i class="fas fa-cog"></i> Advanced Options</span>
              <i class="fas fa-chevron-down" id="advancedIcon"></i>
            </button>
            
            <div class="advanced-content" id="advancedContent">
              <div class="form-group">
                <label for="errorCorrection" class="form-label">Error Correction</label>
                <div class="input-wrapper">
                  <i class="fas fa-shield-alt"></i>
                  <select id="errorCorrection" onchange="updateQR()">
                    <option value="L">Low (7% recovery)</option>
                    <option value="M">Medium (15% recovery)</option>
                    <option value="Q">Quartile (25% recovery)</option>
                    <option value="H" selected>High (30% recovery)</option>
                  </select>
                </div>
              </div>
              
              <div class="form-group">
                <label for="dotsStyle" class="form-label">Dots Style</label>
                <div class="input-wrapper">
                  <i class="fas fa-circle"></i>
                  <select id="dotsStyle" onchange="updateQR()">
                    <option value="square">Square</option>
                    <option value="rounded" selected>Rounded</option>
                    <option value="dots">Dots</option>
                    <option value="classy">Classy</option>
                    <option value="classy-rounded">Classy Rounded</option>
                  </select>
                </div>
              </div>
              
              <div class="form-group">
                <label for="cornersStyle" class="form-label">Corners Style</label>
                <div class="input-wrapper">
                  <i class="fas fa-cube"></i>
                  <select id="cornersStyle" onchange="updateQR()">
                    <option value="square">Square</option>
                    <option value="extra-rounded" selected>Extra Rounded</option>
                    <option value="dot">Dot</option>
                  </select>
                </div>
              </div>
              
              <div class="form-group">
                <label for="qrSize" class="form-label">QR Size</label>
                <div class="slider-container">
                  <div class="slider-header">
                    <span>Dimensions</span>
                    <span class="slider-value" id="qrSizeValue">300px</span>
                  </div>
                  <input type="range" id="qrSize" min="200" max="500" step="10" value="300" oninput="updateQRSize()">
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
      
      <!-- Preview Column -->
      <div class="preview-column">
        <!-- Preview Tab -->
        <div class="tab-content" id="preview-tab">
          <div class="card">
            <div class="card-header">
              <h3 class="card-title">
                <i class="fas fa-eye"></i> QR Code Preview
              </h3>
            </div>
            
            <div class="qr-preview-container" id="qrContainer">
              <div class="loading" id="loading">
                <div class="spinner"></div>
                <p>Generating QR Code...</p>
              </div>
              
              <div id="qr"></div>
              <div class="qr-placeholder" id="qrPlaceholder">
                <i class="fas fa-qrcode"></i>
                <p>Your QR code will appear here</p>
                <p class="form-hint">Configure settings and generate QR code</p>
              </div>
            </div>
            
            <div class="qr-info" id="qrInfo">
              <div class="info-row">
                <span class="info-label">Type:</span>
                <span class="info-value" id="infoType">Text</span>
              </div>
              <div class="info-row">
                <span class="info-label">Size:</span>
                <span class="info-value" id="infoSize">300Ã—300px</span>
              </div>
              <div class="info-row">
                <span class="info-label">Error Correction:</span>
                <span class="info-value" id="infoCorrection">High (30%)</span>
              </div>
              <div class="info-row">
                <span class="info-label">Data Length:</span>
                <span class="info-value" id="infoLength">0 chars</span>
              </div>
            </div>
            
            <div class="message message-warning" id="warningMessage">
              <i class="fas fa-info-circle"></i>
              <span id="warningText"></span>
            </div>
            
            <div class="btn-group">
              <button class="btn btn-primary" onclick="downloadQR('png')" id="downloadPngBtn">
                <i class="fas fa-download"></i> Download PNG
              </button>
              <button class="btn btn-secondary" onclick="downloadQR('svg')" id="downloadSvgBtn">
                <i class="fas fa-download"></i> Download SVG
              </button>
              <button class="btn btn-success" onclick="shareQR()" id="shareBtn">
                <i class="fas fa-share-alt"></i> Share
              </button>
            </div>
          </div>
        </div>
      </div>
    </div>
  </main>
  
  <!-- Footer -->
  <footer class="app-footer">
    <div class="footer-content">
      <p>QR Code Generator &copy; <span id="currentYear"></span></p>
      <div class="footer-links">
        <a href="#" onclick="showHint('Feature coming soon!')">Privacy</a>
        <a href="#" onclick="showHint('Feature coming soon!')">Terms</a>
        <a href="#" onclick="showHint('Feature coming soon!')">Help</a>
      </div>
      <p class="copyright">Made with <i class="fas fa-heart" style="color: #f72585;"></i> for mobile users</p>
    </div>
  </footer>
</div>

<script>
// State management
let qrCode = null;
let selectedLogo = "";
let customLogoFile = null;
let qrGenerated = false;
let currentQRBlob = null;
let currentQRDataURL = null;
let activeTab = "content";

// Available logos with icons
const logos = [
  { id: 'none', name: 'No Logo', icon: 'fas fa-ban' },
  { id: 'url', name: 'Website', icon: 'fas fa-globe', color: '#3b82f6' },
  { id: 'wifi', name: 'Wi-Fi', icon: 'fas fa-wifi', color: '#8b5cf6' },
  { id: 'email', name: 'Email', icon: 'fas fa-envelope', color: '#10b981' },
  { id: 'phone', name: 'Phone', icon: 'fas fa-phone', color: '#f59e0b' },
  { id: 'whatsapp', name: 'WhatsApp', icon: 'fab fa-whatsapp', color: '#25d366' },
  { id: 'sms', name: 'SMS', icon: 'fas fa-sms', color: '#6366f1' },
  { id: 'vcard', name: 'Contact', icon: 'fas fa-address-card', color: '#ec4899' },
  { id: 'location', name: 'Location', icon: 'fas fa-map-marker-alt', color: '#ef4444' },
  { id: 'event', name: 'Event', icon: 'fas fa-calendar', color: '#14b8a6' },
  { id: 'facebook', name: 'Facebook', icon: 'fab fa-facebook', color: '#1877f2' },
  { id: 'instagram', name: 'Instagram', icon: 'fab fa-instagram', color: '#e4405f' },
  { id: 'linkedin', name: 'LinkedIn', icon: 'fab fa-linkedin', color: '#0a66c2' },
  { id: 'twitter', name: 'Twitter', icon: 'fab fa-twitter', color: '#1da1f2' },
  { id: 'youtube', name: 'YouTube', icon: 'fab fa-youtube', color: '#ff0000' },
  { id: 'github', name: 'GitHub', icon: 'fab fa-github', color: '#333' },
  { id: 'paypal', name: 'PayPal', icon: 'fab fa-paypal', color: '#00457c' },
  { id: 'bitcoin', name: 'Bitcoin', icon: 'fab fa-bitcoin', color: '#f7931a' },
];

// Initialize on page load
document.addEventListener('DOMContentLoaded', function() {
  initApp();
  setupEventListeners();
  setCurrentYear();
  
  // Initialize with example
  setTimeout(() => {
    showHint('Welcome! Try entering a URL or text to generate your first QR code.');
  }, 1000);
});

// Initialize app
function initApp() {
  initLogoGrid();
  initQRCode();
  setupTabNavigation();
  onTypeChange();
  
  // Set up mobile menu toggle
  const menuToggle = document.getElementById('menuToggle');
  const appHeader = document.querySelector('.app-header');
  
  menuToggle.addEventListener('click', function() {
    appHeader.classList.toggle('mobile-open');
    if (appHeader.classList.contains('mobile-open')) {
      menuToggle.innerHTML = '<i class="fas fa-times"></i>';
    } else {
      menuToggle.innerHTML = '<i class="fas fa-bars"></i>';
    }
  });
}

// Initialize logo grid with SVG icons
function initLogoGrid() {
  const logoGrid = document.getElementById('logoGrid');
  logoGrid.innerHTML = '';
  
  logos.forEach(logo => {
    const logoElement = document.createElement('div');
    logoElement.className = 'logo-option';
    logoElement.title = logo.name;
    logoElement.dataset.id = logo.id;
    
    // Create SVG icon
    const svgNS = "http://www.w3.org/2000/svg";
    const svg = document.createElementNS(svgNS, "svg");
    svg.setAttribute("viewBox", "0 0 24 24");
    svg.setAttribute("width", "24");
    svg.setAttribute("height", "24");
    
    const use = document.createElementNS(svgNS, "use");
    
    if (logo.id === 'none') {
      // Special case for "no logo" - create an X icon
      const path = document.createElementNS(svgNS, "path");
      path.setAttribute("d", "M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z");
      path.setAttribute("fill", "#6c757d");
      svg.appendChild(path);
    } else {
      // For other logos, we'll use Font Awesome icons via SVG
      const iconClass = logo.icon.split(' ')[1].replace('fa-', '');
      
      // Create a circle background
      const circle = document.createElementNS(svgNS, "circle");
      circle.setAttribute("cx", "12");
      circle.setAttribute("cy", "12");
      circle.setAttribute("r", "10");
      circle.setAttribute("fill", logo.color || '#4361ee');
      svg.appendChild(circle);
      
      // Add icon (simplified - in production you'd use actual SVG paths)
      const text = document.createElementNS(svgNS, "text");
      text.setAttribute("x", "12");
      text.setAttribute("y", "16");
      text.setAttribute("text-anchor", "middle");
      text.setAttribute("fill", "white");
      text.setAttribute("font-size", "10");
      text.setAttribute("font-weight", "bold");
      text.textContent = iconClass.substring(0, 2).toUpperCase();
      svg.appendChild(text);
    }
    
    logoElement.appendChild(svg);
    logoElement.addEventListener('click', () => selectLogo(logo.id));
    
    logoGrid.appendChild(logoElement);
  });
  
  selectLogo('none');
}

// Initialize QR code
function initQRCode() {
  qrCode = new QRCodeStyling({
    width: 300,
    height: 300,
    type: 'canvas',
    data: 'QR Code Generator',
    margin: 10,
    qrOptions: {
      typeNumber: 0,
      mode: 'Byte',
      errorCorrectionLevel: 'H'
    },
    imageOptions: {
      hideBackgroundDots: true,
      imageSize: 0.22,
      margin: 6,
      crossOrigin: 'anonymous'
    },
    dotsOptions: {
      color: '#4361ee',
      type: 'rounded'
    },
    cornersSquareOptions: {
      color: '#4361ee',
      type: 'extra-rounded'
    },
    cornersDotOptions: {
      color: '#4361ee',
      type: 'dot'
    },
    backgroundOptions: {
      color: '#ffffff'
    }
  });
  
  qrCode.append(document.getElementById('qr'));
}

// Set up event listeners
function setupEventListeners() {
  // Input validation
  document.addEventListener('input', function(e) {
    if (e.target.id === 'mainInput' || e.target.id === 'wifiSsid' || 
        e.target.id === 'wifiPassword' || e.target.id === 'emailSubject' ||
        e.target.id === 'smsBody' || e.target.id === 'whatsappMessage' ||
        e.target.id === 'vcardName' || e.target.id === 'vcardPhone' ||
        e.target.id === 'vcardEmail' || e.target.id === 'locationLat' ||
        e.target.id === 'locationLng' || e.target.id === 'eventTitle') {
      validateInput();
    }
  });
  
  // Enter key to generate QR
  document.addEventListener('keypress', function(e) {
    if (e.key === 'Enter' && !e.target.matches('textarea')) {
      e.preventDefault();
      if (activeTab === 'content') {
        generateQR();
      }
    }
  });
  
  // Handle tab visibility change
  document.addEventListener('visibilitychange', function() {
    if (!document.hidden && qrGenerated) {
      // Refresh QR display when tab becomes visible
      setTimeout(updateQR, 100);
    }
  });
}

// Set current year in footer
function setCurrentYear() {
  document.getElementById('currentYear').textContent = new Date().getFullYear();
}

// Setup tab navigation
function setupTabNavigation() {
  const tabButtons = document.querySelectorAll('.tab-btn');
  const mobileTabs = document.getElementById('mobileTabs');
  const desktopTabs = document.getElementById('desktopTabs');
  
  // Function to switch tabs
  const switchTab = (tabId) => {
    // Hide all tab contents
    document.querySelectorAll('.tab-content').forEach(tab => {
      tab.classList.remove('active');
    });
    
    // Show selected tab content
    document.getElementById(`${tabId}-tab`).classList.add('active');
    
    // Update active tab button
    tabButtons.forEach(btn => {
      btn.classList.remove('active');
      if (btn.dataset.tab === tabId) {
        btn.classList.add('active');
      }
    });
    
    activeTab = tabId;
    
    // On mobile, scroll to top when switching tabs
    if (window.innerWidth < 992) {
      window.scrollTo({ top: 0, behavior: 'smooth' });
    }
  };
  
  // Add click event to all tab buttons
  tabButtons.forEach(button => {
    button.addEventListener('click', function() {
      switchTab(this.dataset.tab);
    });
  });
  
  // Handle mobile/desktop tab sync
  if (mobileTabs && desktopTabs) {
    const syncTabs = () => {
      const activeBtn = mobileTabs.querySelector('.tab-btn.active');
      if (activeBtn) {
        const tabId = activeBtn.dataset.tab;
        desktopTabs.querySelectorAll('.tab-btn').forEach(btn => {
          btn.classList.toggle('active', btn.dataset.tab === tabId);
        });
      }
    };
    
    mobileTabs.addEventListener('click', syncTabs);
  }
  
  // Auto-switch to preview after generation
  const originalGenerateQR = generateQR;
  generateQR = async function() {
    await originalGenerateQR();
    if (window.innerWidth < 768) {
      switchTab('preview');
    }
  };
}

// Show hint message
function showHint(message, duration = 3000) {
  const successMessage = document.getElementById('successMessage');
  const successText = document.getElementById('successText');
  
  successText.textContent = message;
  successMessage.classList.add('show');
  
  setTimeout(() => {
    successMessage.classList.remove('show');
  }, duration);
}

// Show warning
function showWarning(message, duration = 4000) {
  const warningMessage = document.getElementById('warningMessage');
  const warningText = document.getElementById('warningText');
  
  warningText.textContent = message;
  warningMessage.classList.add('show');
  
  setTimeout(() => {
    warningMessage.classList.remove('show');
  }, duration);
}

// Show error
function showError(message, duration = 5000) {
  const errorMessage = document.getElementById('errorMessage');
  const errorText = document.getElementById('errorText');
  
  errorText.textContent = message;
  errorMessage.classList.add('show');
  
  setTimeout(() => {
    errorMessage.classList.remove('show');
  }, duration);
}

// Hide all messages
function hideMessages() {
  document.getElementById('errorMessage').classList.remove('show');
  document.getElementById('successMessage').classList.remove('show');
  document.getElementById('warningMessage').classList.remove('show');
}

// Select logo
function selectLogo(logoId) {
  const logo = logos.find(l => l.id === logoId);
  const logoOptions = document.querySelectorAll('.logo-option');
  
  // Update UI
  logoOptions.forEach(opt => {
    if (opt.dataset.id === logoId) {
      opt.classList.add('active');
    } else {
      opt.classList.remove('active');
    }
  });
  
  // Clear custom logo
  document.getElementById('customLogo').value = '';
  customLogoFile = null;
  
  // Set selected logo (for icon-based logos, we use the icon class)
  selectedLogo = logoId === 'none' ? '' : logo.icon;
  
  // Auto-update if QR already generated
  if (qrGenerated) {
    updateQR();
  }
}

// Handle custom logo upload
function handleCustomLogo() {
  const fileInput = document.getElementById('customLogo');
  const file = fileInput.files[0];
  
  if (!file) return;
  
  // Validate file type
  if (!file.type.match('image.*')) {
    showError('Please upload an image file (PNG, JPG, SVG)');
    fileInput.value = '';
    return;
  }
  
  // Validate file size (max 2MB)
  if (file.size > 2 * 1024 * 1024) {
    showError('File size should be less than 2MB');
    fileInput.value = '';
    return;
  }
  
  customLogoFile = file;
  
  // Deselect all logo options
  document.querySelectorAll('.logo-option').forEach(opt => {
    opt.classList.remove('active');
  });
  
  // Auto-update if QR already generated
  if (qrGenerated) {
    updateQR();
  }
  
  showHint('Custom logo uploaded successfully');
}

// Smart logo detection
function detectLogoFromContent(content, type) {
  if (!content) return 'none';
  
  const contentLower = content.toLowerCase();
  
  // Type-based detection
  if (type === 'wifi') return 'wifi';
  if (type === 'email') return 'email';
  if (type === 'phone') return 'phone';
  if (type === 'whatsapp') return 'whatsapp';
  if (type === 'sms') return 'sms';
  if (type === 'vcard') return 'vcard';
  if (type === 'location') return 'location';
  if (type === 'event') return 'event';
  
  // Content-based detection for URLs
  if (contentLower.includes('instagram.com')) return 'instagram';
  if (contentLower.includes('facebook.com')) return 'facebook';
  if (contentLower.includes('linkedin.com')) return 'linkedin';
  if (contentLower.includes('twitter.com') || contentLower.includes('x.com')) return 'twitter';
  if (contentLower.includes('youtube.com') || contentLower.includes('youtu.be')) return 'youtube';
  if (contentLower.includes('github.com')) return 'github';
  if (contentLower.includes('paypal.com')) return 'paypal';
  if (contentLower.includes('bitcoin') || contentLower.includes('btc')) return 'bitcoin';
  
  // URL detection
  if (contentLower.startsWith('http')) return 'url';
  
  return 'none';
}

// Handle type change
function onTypeChange() {
  const type = document.getElementById('qrType').value;
  const dynamicFields = document.getElementById('dynamicFields');
  
  // Clear previous dynamic fields
  dynamicFields.innerHTML = '';
  
  let fieldsHTML = '';
  
  switch (type) {
    case 'wifi':
      fieldsHTML = `
        <div class="form-group">
          <label for="wifiSsid" class="form-label">Wi-Fi Network Name</label>
          <p class="form-hint">Enter the exact name of your Wi-Fi network</p>
          <div class="input-wrapper">
            <i class="fas fa-wifi"></i>
            <input type="text" id="wifiSsid" placeholder="MyHomeWiFi" oninput="validateInput()">
          </div>
        </div>
        <div class="form-group">
          <label for="wifiPassword" class="form-label">Password</label>
          <p class="form-hint">Leave empty for open networks</p>
          <div class="input-wrapper">
            <i class="fas fa-key"></i>
            <input type="text" id="wifiPassword" placeholder="Enter password" oninput="validateInput()">
          </div>
        </div>
        <div class="form-group">
          <label for="wifiSecurity" class="form-label">Security Type</label>
          <div class="input-wrapper">
            <i class="fas fa-shield-alt"></i>
            <select id="wifiSecurity" onchange="validateInput()">
              <option value="WPA">WPA/WPA2</option>
              <option value="WEP">WEP</option>
              <option value="nopass">No Password</option>
            </select>
          </div>
        </div>
      `;
      break;
      
    case 'email':
      fieldsHTML = `
        <div class="form-group">
          <label for="mainInput" class="form-label">Email Address</label>
          <p class="form-hint">Recipient's email address</p>
          <div class="input-wrapper">
            <i class="fas fa-at"></i>
            <input type="email" id="mainInput" placeholder="example@domain.com" oninput="validateInput()">
          </div>
        </div>
        <div class="form-group">
          <label for="emailSubject" class="form-label">Subject (Optional)</label>
          <div class="input-wrapper">
            <i class="fas fa-heading"></i>
            <input type="text" id="emailSubject" placeholder="Email subject" oninput="validateInput()">
          </div>
        </div>
        <div class="form-group">
          <label for="emailBody" class="form-label">Message (Optional)</label>
          <div class="input-wrapper">
            <i class="fas fa-align-left"></i>
            <textarea id="emailBody" placeholder="Email body" oninput="validateInput()"></textarea>
          </div>
        </div>
      `;
      break;
      
    case 'sms':
      fieldsHTML = `
        <div class="form-group">
          <label for="mainInput" class="form-label">Phone Number</label>
          <p class="form-hint">Recipient's phone number with country code</p>
          <div class="input-wrapper">
            <i class="fas fa-phone"></i>
            <input type="tel" id="mainInput" placeholder="+1234567890" oninput="validateInput()">
          </div>
        </div>
        <div class="form-group">
          <label for="smsBody" class="form-label">Message (Optional)</label>
          <div class="input-wrapper">
            <i class="fas fa-comment"></i>
            <textarea id="smsBody" placeholder="SMS message" oninput="validateInput()"></textarea>
          </div>
        </div>
      `;
      break;
      
    case 'whatsapp':
      fieldsHTML = `
        <div class="form-group">
          <label for="mainInput" class="form-label">WhatsApp Number</label>
          <p class="form-hint">Phone number with country code (without +)</p>
          <div class="input-wrapper">
            <i class="fab fa-whatsapp"></i>
            <input type="tel" id="mainInput" placeholder="1234567890" oninput="validateInput()">
          </div>
        </div>
        <div class="form-group">
          <label for="whatsappMessage" class="form-label">Message (Optional)</label>
          <div class="input-wrapper">
            <i class="fas fa-comment"></i>
            <textarea id="whatsappMessage" placeholder="WhatsApp message" oninput="validateInput()"></textarea>
          </div>
        </div>
      `;
      break;
      
    case 'vcard':
      fieldsHTML = `
        <div class="form-group">
          <label for="vcardName" class="form-label">Full Name</label>
          <div class="input-wrapper">
            <i class="fas fa-user"></i>
            <input type="text" id="vcardName" placeholder="John Doe" oninput="validateInput()">
          </div>
        </div>
        <div class="form-group">
          <label for="vcardPhone" class="form-label">Phone Number</label>
          <div class="input-wrapper">
            <i class="fas fa-phone"></i>
            <input type="tel" id="vcardPhone" placeholder="+1234567890" oninput="validateInput()">
          </div>
        </div>
        <div class="form-group">
          <label for="vcardEmail" class="form-label">Email Address</label>
          <div class="input-wrapper">
            <i class="fas fa-envelope"></i>
            <input type="email" id="vcardEmail" placeholder="john@example.com" oninput="validateInput()">
          </div>
        </div>
      `;
      break;
      
    case 'location':
      fieldsHTML = `
        <div class="form-group">
          <label for="locationLat" class="form-label">Latitude</label>
          <div class="input-wrapper">
            <i class="fas fa-globe-americas"></i>
            <input type="number" id="locationLat" step="any" placeholder="40.7128" oninput="validateInput()">
          </div>
        </div>
        <div class="form-group">
          <label for="locationLng" class="form-label">Longitude</label>
          <div class="input-wrapper">
            <i class="fas fa-globe-americas"></i>
            <input type="number" id="locationLng" step="any" placeholder="-74.0060" oninput="validateInput()">
          </div>
        </div>
      `;
      break;
      
    case 'event':
      fieldsHTML = `
        <div class="form-group">
          <label for="eventTitle" class="form-label">Event Title</label>
          <div class="input-wrapper">
            <i class="fas fa-heading"></i>
            <input type="text" id="eventTitle" placeholder="Team Meeting" oninput="validateInput()">
          </div>
        </div>
        <div class="form-group">
          <label for="eventDate" class="form-label">Date & Time</label>
          <div class="input-wrapper">
            <i class="fas fa-calendar"></i>
            <input type="datetime-local" id="eventDate" oninput="validateInput()">
          </div>
        </div>
      `;
      break;
      
    default: // text
      fieldsHTML = `
        <div class="form-group">
          <label for="mainInput" class="form-label">Content</label>
          <p class="form-hint" id="mainHint">Enter text, URL, or any content</p>
          <div class="input-wrapper">
            <i class="fas fa-link"></i>
            <input type="text" id="mainInput" placeholder="https://example.com or any text" oninput="validateInput()">
          </div>
        </div>
      `;
  }
  
  dynamicFields.innerHTML = fieldsHTML;
  
  // Auto-select appropriate logo
  const logoId = detectLogoFromContent('', type);
  selectLogo(logoId);
  
  hideMessages();
  
  // Set placeholder based on type
  const mainInput = document.getElementById('mainInput');
  if (mainInput) {
    const placeholders = {
      text: 'https://example.com or any text',
      email: 'example@domain.com',
      phone: '+1234567890',
      whatsapp: '1234567890',
      sms: '+1234567890'
    };
    mainInput.placeholder = placeholders[type] || 'Enter content';
  }
}

// Validate input
function validateInput() {
  const type = document.getElementById('qrType').value;
  let isValid = true;
  let errorMessage = '';
  
  hideMessages();
  
  // Type-specific validation
  if (type === 'wifi') {
    const ssid = document.getElementById('wifiSsid');
    if (ssid && !ssid.value.trim()) {
      isValid = false;
      errorMessage = 'Wi-Fi network name is required';
    }
  } else if (type === 'email') {
    const email = document.getElementById('mainInput');
    if (email && email.value.trim()) {
      const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
      if (!emailRegex.test(email.value.trim())) {
        isValid = false;
        errorMessage = 'Please enter a valid email address';
      }
    }
  } else if (type === 'phone' || type === 'sms' || type === 'whatsapp') {
    const phone = document.getElementById('mainInput');
    if (phone && phone.value.trim()) {
      const phoneRegex = /^[\+\d\s\-\(\)]{10,}$/;
      if (!phoneRegex.test(phone.value.trim())) {
        isValid = false;
        errorMessage = 'Please enter a valid phone number';
      }
    }
  } else if (type === 'vcard') {
    const name = document.getElementById('vcardName');
    if (name && !name.value.trim()) {
      isValid = false;
      errorMessage = 'Full name is required';
    }
  } else if (type === 'location') {
    const lat = document.getElementById('locationLat');
    const lng = document.getElementById('locationLng');
    
    if (lat && lng) {
      const latVal = parseFloat(lat.value);
      const lngVal = parseFloat(lng.value);
      
      if (!lat.value.trim() || !lng.value.trim()) {
        isValid = false;
        errorMessage = 'Both latitude and longitude are required';
      } else if (isNaN(latVal) || latVal < -90 || latVal > 90) {
        isValid = false;
        errorMessage = 'Latitude must be between -90 and 90';
      } else if (isNaN(lngVal) || lngVal < -180 || lngVal > 180) {
        isValid = false;
        errorMessage = 'Longitude must be between -180 and 180';
      }
    }
  } else if (type === 'event') {
    const title = document.getElementById('eventTitle');
    if (title && !title.value.trim()) {
      isValid = false;
      errorMessage = 'Event title is required';
    }
  } else if (type === 'text') {
    const mainInput = document.getElementById('mainInput');
    if (mainInput && !mainInput.value.trim()) {
      isValid = false;
      errorMessage = 'Content is required';
    }
  }
  
  if (!isValid) {
    showError(errorMessage);
  }
  
  return isValid;
}

// Build payload
function buildPayload() {
  const type = document.getElementById('qrType').value;
  
  switch (type) {
    case 'wifi':
      const ssid = document.getElementById('wifiSsid').value.trim();
      const password = document.getElementById('wifiPassword')?.value.trim() || '';
      const security = document.getElementById('wifiSecurity').value;
      return `WIFI:T:${security};S:${ssid};P:${password};;`;
      
    case 'email':
      const email = document.getElementById('mainInput').value.trim();
      const subject = document.getElementById('emailSubject')?.value.trim() || '';
      const body = document.getElementById('emailBody')?.value.trim() || '';
      
      let mailto = `mailto:${email}`;
      const params = [];
      if (subject) params.push(`subject=${encodeURIComponent(subject)}`);
      if (body) params.push(`body=${encodeURIComponent(body)}`);
      
      if (params.length > 0) {
        mailto += '?' + params.join('&');
      }
      return mailto;
      
    case 'phone':
      const phone = document.getElementById('mainInput').value.trim().replace(/\D/g, '');
      return `tel:${phone}`;
      
    case 'sms':
      const smsPhone = document.getElementById('mainInput').value.trim().replace(/\D/g, '');
      const smsBody = document.getElementById('smsBody')?.value.trim() || '';
      return `SMSTO:${smsPhone}:${encodeURIComponent(smsBody)}`;
      
    case 'whatsapp':
      const whatsappPhone = document.getElementById('mainInput').value.trim().replace(/\D/g, '');
      const whatsappMessage = document.getElementById('whatsappMessage')?.value.trim() || '';
      return `https://wa.me/${whatsappPhone}?text=${encodeURIComponent(whatsappMessage)}`;
      
    case 'vcard':
      const name = document.getElementById('vcardName')?.value.trim() || '';
      const vcardPhone = document.getElementById('vcardPhone')?.value.trim() || '';
      const vcardEmail = document.getElementById('vcardEmail')?.value.trim() || '';
      return `BEGIN:VCARD\nVERSION:3.0\nFN:${name}\nTEL:${vcardPhone}\nEMAIL:${vcardEmail}\nEND:VCARD`;
      
    case 'location':
      const lat = document.getElementById('locationLat')?.value || '0';
      const lng = document.getElementById('locationLng')?.value || '0';
      return `geo:${lat},${lng}`;
      
    case 'event':
      const title = document.getElementById('eventTitle')?.value.trim() || 'Event';
      const date = document.getElementById('eventDate')?.value || new Date().toISOString().slice(0, 16);
      return `BEGIN:VEVENT\nSUMMARY:${title}\nDTSTART:${date.replace(/[-:]/g, '')}00Z\nEND:VEVENT`;
      
    default: // text
      return document.getElementById('mainInput').value.trim();
  }
}

// Generate QR code
async function generateQR() {
  // Validate input
  if (!validateInput()) {
    return;
  }
  
  const loading = document.getElementById('loading');
  const generateBtn = document.getElementById('generateBtn');
  
  loading.classList.add('show');
  generateBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Generating...';
  generateBtn.disabled = true;
  
  // Small delay for better UX
  await new Promise(resolve => setTimeout(resolve, 300));
  
  try {
    const payload = buildPayload();
    
    // Auto-detect logo
    const type = document.getElementById('qrType').value;
    const mainInput = document.getElementById('mainInput')?.value || '';
    
    if (!customLogoFile && !selectedLogo) {
      const detectedLogo = detectLogoFromContent(mainInput, type);
      selectLogo(detectedLogo);
    }
    
    // Create image source
    let imageSrc = '';
    if (customLogoFile) {
      imageSrc = URL.createObjectURL(customLogoFile);
    } else if (selectedLogo && selectedLogo !== 'none') {
      // For icon-based logos, we'd use a different approach
      // For now, we'll skip the logo if it's just an icon class
      imageSrc = '';
    }
    
    // Update QR code
    qrCode.update({
      data: payload,
      image: imageSrc,
      width: parseInt(document.getElementById('qrSize').value),
      height: parseInt(document.getElementById('qrSize').value),
      margin: parseInt(document.getElementById('margin').value),
      qrOptions: {
        errorCorrectionLevel: document.getElementById('errorCorrection').value
      },
      imageOptions: {
        hideBackgroundDots: true,
        imageSize: parseFloat(document.getElementById('logoSize').value),
        margin: 6
      },
      dotsOptions: {
        color: document.getElementById('foregroundColor').value,
        type: document.getElementById('dotsStyle').value
      },
      cornersSquareOptions: {
        color: document.getElementById('foregroundColor').value,
        type: document.getElementById('cornersStyle').value
      },
      cornersDotOptions: {
        color: document.getElementById('foregroundColor').value,
        type: 'dot'
      },
      backgroundOptions: {
        color: document.getElementById('backgroundColor').value
      }
    });
    
    // Get fresh blob for sharing
    try {
      currentQRBlob = await qrCode.getRawData('png');
      const canvas = document.querySelector('#qr canvas');
      if (canvas) {
        currentQRDataURL = canvas.toDataURL('image/png');
      }
    } catch (error) {
      console.warn('Could not get blob data:', error);
    }
    
    // Update UI
    document.getElementById('qrPlaceholder').style.display = 'none';
    document.getElementById('qrContainer').classList.add('has-qr');
    document.getElementById('qrInfo').classList.add('show');
    
    // Update info
    document.getElementById('infoType').textContent = 
      document.getElementById('qrType').selectedOptions[0].text;
    document.getElementById('infoSize').textContent = 
      `${document.getElementById('qrSize').value}Ã—${document.getElementById('qrSize').value}px`;
    document.getElementById('infoCorrection').textContent = 
      document.getElementById('errorCorrection').selectedOptions[0].text;
    document.getElementById('infoLength').textContent = 
      `${payload.length} characters`;
    
    qrGenerated = true;
    showHint('QR code generated successfully!', 2000);
    
  } catch (error) {
    console.error('Error generating QR:', error);
    showError('Failed to generate QR code. Please try again.');
  } finally {
    loading.classList.remove('show');
    generateBtn.innerHTML = '<i class="fas fa-bolt"></i> Generate QR Code';
    generateBtn.disabled = false;
  }
}

// Update QR
function updateQR() {
  if (qrGenerated) {
    generateQR();
  }
}

// Update colors
function updateColors() {
  if (qrGenerated) {
    generateQR();
  }
}

// Update logo size
function updateLogoSize() {
  const value = document.getElementById('logoSize').value;
  document.getElementById('logoSizeValue').textContent = 
    `${Math.round(value * 100)}%`;
  
  if (qrGenerated) {
    updateQR();
  }
}

// Update margin
function updateMargin() {
  const value = document.getElementById('margin').value;
  document.getElementById('marginValue').textContent = `${value}px`;
  
  if (qrGenerated) {
    updateQR();
  }
}

// Update QR size
function updateQRSize() {
  const value = document.getElementById('qrSize').value;
  document.getElementById('qrSizeValue').textContent = `${value}px`;
  
  if (qrGenerated) {
    updateQR();
  }
}

// Toggle advanced options
function toggleAdvanced() {
  const content = document.getElementById('advancedContent');
  const icon = document.getElementById('advancedIcon');
  
  content.classList.toggle('expanded');
  icon.classList.toggle('fa-chevron-down');
  icon.classList.toggle('fa-chevron-up');
  
  // Scroll into view on mobile
  if (window.innerWidth < 768 && content.classList.contains('expanded')) {
    content.scrollIntoView({ behavior: 'smooth', block: 'nearest' });
  }
}

// Download QR
async function downloadQR(format) {
  if (!qrGenerated) {
    showWarning('Please generate a QR code first');
    return;
  }
  
  const type = document.getElementById('qrType').value;
  let filename = 'qr-code';
  
  // Generate filename
  if (type === 'text') {
    const mainInput = document.getElementById('mainInput')?.value || '';
    if (mainInput) {
      const urlMatch = mainInput.match(/https?:\/\/([^\/]+)/);
      if (urlMatch) {
        filename = `qr-${urlMatch[1].replace(/[^a-z0-9]/gi, '-')}`;
      } else if (mainInput.length < 20) {
        filename = `qr-${mainInput.replace(/[^a-z0-9]/gi, '-')}`;
      }
    }
  } else if (type === 'wifi') {
    const ssid = document.getElementById('wifiSsid')?.value || '';
    if (ssid) filename = `qr-wifi-${ssid.replace(/[^a-z0-9]/gi, '-')}`;
  }
  
  filename = filename.toLowerCase().substring(0, 50);
  
  try {
    if (format === 'svg') {
      await qrCode.download({ name: filename, extension: 'svg' });
    } else {
      if (currentQRBlob) {
        const url = URL.createObjectURL(currentQRBlob);
        const a = document.createElement('a');
        a.href = url;
        a.download = `${filename}.png`;
        document.body.appendChild(a);
        a.click();
        document.body.removeChild(a);
        URL.revokeObjectURL(url);
      } else {
        await qrCode.download({ name: filename, extension: 'png' });
      }
    }
    
    showHint(`QR code downloaded as ${format.toUpperCase()}!`, 2000);
  } catch (error) {
    console.error('Download failed:', error);
    showError('Failed to download QR code');
  }
}

// Share QR
async function shareQR() {
  if (!qrGenerated) {
    showWarning('Please generate a QR code first');
    return;
  }
  
  const shareBtn = document.getElementById('shareBtn');
  const originalText = shareBtn.innerHTML;
  shareBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Sharing...';
  shareBtn.disabled = true;
  
  try {
    // Create fresh file
    if (!currentQRBlob) {
      currentQRBlob = await qrCode.getRawData('png');
    }
    
    const timestamp = new Date().getTime();
    const file = new File([currentQRBlob], `qr-code-${timestamp}.png`, {
      type: 'image/png',
      lastModified: timestamp
    });
    
    if (navigator.share && navigator.canShare) {
      if (navigator.canShare({ files: [file] })) {
        await navigator.share({
          files: [file],
          title: 'QR Code',
          text: 'Check out this QR code I created!'
        });
        showHint('QR code shared successfully!', 2000);
      } else {
        const payload = buildPayload();
        await navigator.share({
          title: 'QR Code',
          text: `Check out this QR code I created! It contains: ${payload.substring(0, 100)}...`
        });
        showHint('QR code information shared!', 2000);
      }
    } else if (navigator.clipboard && currentQRDataURL) {
      // Copy to clipboard
      const canvas = document.createElement('canvas');
      const ctx = canvas.getContext('2d');
      const img = new Image();
      
      img.onload = async function() {
        canvas.width = img.width;
        canvas.height = img.height;
        ctx.drawImage(img, 0, 0);
        
        canvas.toBlob(async function(blob) {
          try {
            const item = new ClipboardItem({ 'image/png': blob });
            await navigator.clipboard.write([item]);
            showHint('QR code copied to clipboard!', 2000);
          } catch (err) {
            const text = `QR Code: ${buildPayload().substring(0, 100)}...`;
            await navigator.clipboard.writeText(text);
            showHint('QR code info copied to clipboard!', 2000);
          }
        });
      };
      
      img.src = currentQRDataURL;
    } else {
      const text = `QR Code: ${buildPayload().substring(0, 100)}...`;
      await navigator.clipboard.writeText(text);
      showHint('QR code info copied to clipboard!', 2000);
    }
  } catch (error) {
    console.error('Sharing failed:', error);
    if (error.name !== 'AbortError') {
      showError('Sharing not supported. Try downloading instead.');
    }
  } finally {
    shareBtn.innerHTML = originalText;
    shareBtn.disabled = false;
  }
}

// Reset settings
function resetSettings() {
  if (qrGenerated && !confirm('Reset all settings? Your current QR code will be lost.')) {
    return;
  }
  
  document.getElementById('qrType').value = 'text';
  document.getElementById('customLogo').value = '';
  
  // Reset sliders
  document.getElementById('logoSize').value = 0.22;
  document.getElementById('logoSizeValue').textContent = '22%';
  document.getElementById('margin').value = 10;
  document.getElementById('marginValue').textContent = '10px';
  document.getElementById('qrSize').value = 300;
  document.getElementById('qrSizeValue').textContent = '300px';
  
  // Reset colors
  document.getElementById('foregroundColor').value = '#4361ee';
  document.getElementById('backgroundColor').value = '#ffffff';
  
  // Reset advanced options
  document.getElementById('errorCorrection').value = 'H';
  document.getElementById('dotsStyle').value = 'rounded';
  document.getElementById('cornersStyle').value = 'extra-rounded';
  
  // Reset logo
  selectLogo('none');
  
  // Reset UI
  document.getElementById('qrPlaceholder').style.display = 'block';
  document.getElementById('qrContainer').classList.remove('has-qr');
  document.getElementById('qrInfo').classList.remove('show');
  hideMessages();
  
  // Clear blob
  currentQRBlob = null;
  currentQRDataURL = null;
  
  // Update fields
  onTypeChange();
  
  // Reset QR
  qrCode.update({
    data: 'QR Code Generator',
    image: '',
    width: 300,
    height: 300,
    margin: 10,
    qrOptions: { errorCorrectionLevel: 'H' },
    imageOptions: { imageSize: 0.22, margin: 6 },
    dotsOptions: { color: '#4361ee', type: 'rounded' },
    cornersSquareOptions: { color: '#4361ee', type: 'extra-rounded' },
    backgroundOptions: { color: '#ffffff' }
  });
  
  qrGenerated = false;
  showHint('All settings have been reset', 2000);
}
</script>
</body>
</html>