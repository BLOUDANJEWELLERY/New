<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>PDF to Images Converter</title>
  <style>
    body { font-family: "Segoe UI", sans-serif; background:#f9fafc; margin:0; }
    header { background:#4f8cff; color:white; padding:20px; text-align:center; font-size:1.5rem; font-weight:bold; }
    .container { max-width:900px; margin:30px auto; padding:20px; background:white; border-radius:10px; box-shadow:0 4px 12px rgba(0,0,0,0.1); }
    h2 { color:#4f8cff; margin-top:20px; }
    input[type="file"], select { margin:10px 0; }
    button { background:#4f8cff; border:none; color:white; padding:10px 16px; border-radius:6px; font-weight:600; cursor:pointer; margin-right:10px; }
    button.secondary { background:#777; }
    #status { margin-top:10px; font-size:0.95rem; color:#555; }
    .progress { height:10px; background:#eee; border-radius:5px; overflow:hidden; margin-top:10px; }
    .progress div { height:100%; width:0%; background:#4f8cff; transition:width 0.3s ease; }
    .grid { margin-top:20px; display:grid; grid-template-columns:repeat(auto-fill,minmax(250px,1fr)); gap:20px; }
    .card { border:1px solid #ddd; border-radius:8px; background:#fafafa; }
    .card-header { background:#f0f4ff; padding:8px 12px; font-weight:600; font-size:0.9rem; }
    .card-body { padding:12px; text-align:center; }
    .card-body img { max-width:100%; border:1px solid #ccc; border-radius:6px; }
    .actions { margin-top:10px; display:flex; justify-content:center; gap:10px; }
    .actions a, .actions button { font-size:0.85rem; padding:6px 10px; }
  </style>
</head>
<body>
  <header>PDF → Images Converter</header>
  <div class="container">
    <h2>Step 1: Upload your PDF</h2>
    <input id="pdfFile" type="file" accept="application/pdf" />
    <h2>Step 2: Choose Resolution</h2>
    <select id="resolutionSelect">
      <option value="2">Low (Scale 2)</option>
      <option value="4">Medium (Scale 4)</option>
      <option value="6" selected>High (Scale 6)</option>
      <option value="10">Ultra (Scale 10)</option>
    </select>
    <h2>Step 3: Convert</h2>
    <button id="convertBtn">Convert</button>
    <button id="clearBtn" class="secondary">Clear</button>
    <button id="downloadZipBtn" class="secondary" disabled>Download All as ZIP</button>
    <div id="status">Select a PDF and click Convert.</div>
    <div class="progress"><div id="progressFill"></div></div>
    <h2>Step 4: Download Images</h2>
    <div id="output" class="grid"></div>
  </div>

  <!-- PDF.js -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.min.js"></script>
  <!-- JSZip + FileSaver -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/FileSaver.js/2.0.5/FileSaver.min.js"></script>

  <script>
    pdfjsLib.GlobalWorkerOptions.workerSrc =
      'https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.worker.min.js';

    const pdfInput = document.getElementById('pdfFile');
    const convertBtn = document.getElementById('convertBtn');
    const clearBtn = document.getElementById('clearBtn');
    const downloadZipBtn = document.getElementById('downloadZipBtn');
    const resolutionSelect = document.getElementById('resolutionSelect');
    const output = document.getElementById('output');
    const statusEl = document.getElementById('status');
    const progressFill = document.getElementById('progressFill');

    let imagesData = [];

    clearBtn.addEventListener('click', () => {
      output.innerHTML = '';
      statusEl.textContent = 'Select a PDF and click Convert.';
      progressFill.style.width = '0%';
      pdfInput.value = '';
      imagesData = [];
      downloadZipBtn.disabled = true;
    });

    convertBtn.addEventListener('click', async () => {
      const file = pdfInput.files?.[0];
      if (!file) {
        statusEl.textContent = '⚠️ Please choose a PDF file first.';
        return;
      }

      output.innerHTML = '';
      statusEl.textContent = 'Loading PDF…';
      progressFill.style.width = '0%';
      imagesData = [];

      const scale = parseFloat(resolutionSelect.value);

      try {
        const arrayBuffer = await file.arrayBuffer();
        const pdf = await pdfjsLib.getDocument({ data: arrayBuffer }).promise;

        for (let pageNum = 1; pageNum <= pdf.numPages; pageNum++) {
          const page = await pdf.getPage(pageNum);
          const viewport = page.getViewport({ scale });

          const canvas = document.createElement('canvas');
          const context = canvas.getContext('2d');
          canvas.width = viewport.width;
          canvas.height = viewport.height;

          await page.render({ canvasContext: context, viewport }).promise;
          const dataURL = canvas.toDataURL('image/png');

          imagesData.push({ name: `page-${pageNum}.png`, dataURL });

          const card = document.createElement('div');
          card.className = 'card';
          card.innerHTML = `
            <div class="card-header">Page ${pageNum}</div>
            <div class="card-body">
              <img src="${dataURL}" alt="Page ${pageNum}" />
              <div class="actions">
                <a href="${dataURL}" download="page-${pageNum}.png">Download PNG</a>
              </div>
            </div>
          `;
          output.appendChild(card);

          const pct = Math.round((pageNum / pdf.numPages) * 100);
          progressFill.style.width = pct + '%';
          statusEl.textContent = `Rendered ${pageNum}/${pdf.numPages} pages (${pct}%).`;
        }
        statusEl.textContent = '✅ Conversion complete. Download images below or as ZIP.';
        downloadZipBtn.disabled = false;
      } catch (err) {
        statusEl.textContent = '❌ Failed to process PDF.';
        console.error(err);
      }
    });

    downloadZipBtn.addEventListener('click', async () => {
      if (!imagesData.length) return;
      const zip = new JSZip();
      imagesData.forEach(img => {
        const base64 = img.dataURL.split(',')[1];
        zip.file(img.name, base64, { base64: true });
      });
      const content = await zip.generateAsync({ type: "blob" });
      saveAs(content, "pdf-images.zip");
    });
  </script>
</body>
</html>
